{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
  <div class="row">
    <div class="col-md-6">
      <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" alt="{{ movie.title }}" class="img-fluid">
    </div>
    <div class="col-md-6">
      <h1>{{ movie.title }}</h1>
      <!-- Average Rating -->
      <p class="fs-5">
        {% if average_rating %}
          <span>⭐ {{ average_rating|floatformat:1 }}/10</span>
        {% else %}
          <span class="text-muted">No ratings yet</span>
        {% endif %}
      </p>

      <p><strong>Release Date:</strong> {{ movie.release_date }}</p>
      <p>{{ movie.overview }}</p>

      <h3 class="mt-4">User Reviews</h3>
      {% for review in reviews %}
        <div class="border rounded p-3 mb-3 review-container">
          <p><strong>{{ review.user.username }}</strong></p>
          <p>{{ review.created_at|date:"M d, Y" }}</p>
          <p>⭐ {{ review.rating }}/10</p>
          <p>{{ review.text }}</p>
        </div>
      {% empty %}
        <p>No reviews yet. Be the first to review this movie!</p>
      {% endfor %}

      {% if user.is_authenticated %}
        <h3 class="mt-4">Write a Review</h3>
        <form method="post">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit" class="btn btn-primary mt-2">Submit Review</button>
        </form>
      {% else %}
        <p><a href="{% url 'users:login' %}">Log in</a> to write a review.</p>
      {% endif %}

    </div>
  </div>
</div>

<style>
  .review-container {
    word-wrap: break-word; /* Break long words */
    overflow-wrap: break-word; /* Ensure words wrap properly */
    max-width: 100%; /* Prevent stretching beyond container */
    white-space: normal; /* Ensures text wraps instead of overflowing */
  }
</style>

{% endblock content %}